{% extends "base.html" %}
{% block content %}

<h2>Our Menu</h2>
<p style="font-size:13px;color:#6b7280;margin-top:-4px;margin-bottom:14px;">
    Choose category or type to filter dishes from Mission Shakti Cafe.
</p>

<!-- =====================
     FILTER BAR
     ===================== -->
<div class="filter-bar">
    {% for f in filters %}
        <a href="{{ url_for('menu', filter=f) }}"
           class="filter-chip {% if current_filter == f %}active{% endif %}">
            {{ f }}
        </a>
    {% endfor %}
</div>

{% if menu_items %}

<!-- =====================
     MENU GRID
     ===================== -->
<div class="menu-grid">

    {% for item in menu_items %}
    <div class="menu-card">

        <!-- Discount -->
        {% if item.mrp and item.mrp > item.price %}
            {% set discount = ((item.mrp - item.price) * 100 // item.mrp) %}
            <div class="discount-badge">
                {{ discount }}% OFF
            </div>
        {% endif %}

        <!-- Image -->
        <div class="dish-image-wrapper">
            {% if item.image_filename %}
                <img src="{{ url_for('static', filename='uploads/' ~ item.image_filename) }}"
                     alt="{{ item.name }}"
                     class="dish-image">
            {% else %}
                <img src="{{ url_for('static', filename='images/default_food.jpg') }}"
                     alt="{{ item.name }}"
                     class="dish-image">
            {% endif %}
        </div>

        <!-- Name -->
        <h3>{{ item.name }}</h3>

        <!-- Category -->
        <p class="category">
            {{ item.category }}
            {% if item.veg_type %}
                • {{ item.veg_type }}
            {% endif %}
        </p>

        <!-- Tags -->
        <div class="tag-badges">
            {% if item.is_best_seller %}
                <span class="tag-badge best">Best Seller</span>
            {% endif %}
            {% if item.is_new %}
                <span class="tag-badge new">New</span>
            {% endif %}
        </div>

        <!-- Price -->
        {% if item.mrp and item.mrp > item.price %}
            <p class="mrp">MRP <s>₹ {{ item.mrp }}</s></p>
        {% endif %}
        <p class="price">₹ {{ item.price }}</p>

        <!-- Actions -->
        <div class="menu-actions">
            <a class="btn small"
               href="{{ url_for('add_to_cart', item_id=item.id) }}">
                Add to Cart
            </a>

            {% set msg =
                'I want to order ' ~ item.name ~
                ' for ₹' ~ item.price ~
                ' from Mission Shakti Cafe.'
            %}
            <a class="btn btn-outline small"
               href="https://wa.me/917894332390?text={{ msg|urlencode }}"
               target="_blank">
                WhatsApp
            </a>
        </div>

    </div>
    {% endfor %}

</div>

{% else %}
    <p style="margin-top:12px;font-size:14px;color:#6b7280;">
        No dishes found for this filter.
        Please try another category or order via WhatsApp.
    </p>
{% endif %}

<!-- =====================
     MOBILE FILTER STYLE
     ===================== -->
<style>
.filter-bar {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 14px;
}

.filter-chip {
    padding: 6px 12px;
    font-size: 12px;
    border-radius: 999px;
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #e5e7eb;
}

.filter-chip.active {
    background: #b91c1c;
    color: #ffffff;
    border-color: #b91c1c;
}

@media (max-width: 600px) {
    .filter-bar {
        overflow-x: auto;
        flex-wrap: nowrap;
    }
}
</style>

{% endblock %}
